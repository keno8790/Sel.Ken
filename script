// script.js - Popup fragt "liebst du mich so sehr wie ich dich" und zeigt nach Bestätigung das Bild.
// Erwartet, dass das Bild unter images/photo.jpg liegt (relativer Pfad).
// Optional: ?img=URL kann eine Bild-URL übergeben (URL-encoded), diese hat Vorrang.

(function(){
  const overlay = document.getElementById('overlay');
  const yesBtn = document.getElementById('yesBtn');
  const mediaContainer = document.getElementById('mediaContainer');
  const mainPhoto = document.getElementById('mainPhoto');

  // Standard-Fallback: lokales Bild im repo
  const localFallback = 'images/photo.jpg';

  // Hilfsfunktion: lese query param
  function getQueryParam(name){
    try {
      const u = new URL(window.location.href);
      return u.searchParams.get(name);
    } catch (e){
      return null;
    }
  }

  // Bildquelle: ?img=... hat Vorrang; ansonsten lokales Bild
  let imgUrl = getQueryParam('img') || localFallback;
  try { imgUrl = decodeURIComponent(imgUrl); } catch (e){ /* ignore */ }

  // Wenn das Bild nicht existiert oder nicht geladen werden kann, zeigen wir eine Nachricht und bleiben im Overlay.
  function showImage(){
    // Setze src zuletzt, um onerror/onload zu fangen
    mainPhoto.onload = () => {
      // Bild geladen, blend overlay aus (falls noch sichtbar)
      overlay.classList.add('hidden');
      mediaContainer.classList.remove('hidden');
    };
    mainPhoto.onerror = () => {
      // Fehlerbehandlung: falls imgUrl ein externes URL war, zeige eine Fehlermeldung
      alert('Das Bild konnte nicht geladen werden. Bitte überprüfe den Pfad oder lade das Bild unter images/photo.jpg hoch.');
      overlay.classList.remove('hidden');
      mediaContainer.classList.add('hidden');
    };

    // Starten
    mainPhoto.src = imgUrl;
  }

  // Klick-Handler für JA
  yesBtn.addEventListener('click', () => {
    // Kleines visuelles Feedback: disable Button kurz
    yesBtn.disabled = true;
    yesBtn.style.opacity = '0.6';
    // Zeige das Bild
    showImage();
    // Re-enable nach kurzer Zeit (nur für UX)
    setTimeout(() => {
      yesBtn.disabled = false;
      yesBtn.style.opacity = '';
    }, 800);
  });

  // Enter-/Space-Taste löst JA aus, falls Overlay sichtbar
  document.addEventListener('keydown', (e) => {
    if (!overlay.classList.contains('hidden') && (e.key === 'Enter' || e.key === ' ')) {
      e.preventDefault();
      yesBtn.click();
    }
  });

  // Accessibility: fokus auf Button beim Laden
  window.addEventListener('load', () => {
    yesBtn.focus();
  });
})();
